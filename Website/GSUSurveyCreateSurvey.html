<?php

include_once 'includes/db-connect.php';
include_once 'includes/functions.php';

sec_session_start();


?>
<!DOCTYPE HTML>
<html>
	<head>
		<title>GSU Create Survey</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" href="GSUSurvey.css">
		<script type="text/javascript">
			var questionNum = 0;
			function addQuestion(){
				questionNum++;
				var lineBreak = document.createElement("br");
				var div = document.createElement("div");
				div.id = "question"+ questionNum;
				div.className = "question";
				var question = prompt("What is your question?");


				var text = document.createElement("input");
				text.type = "input";
				text.value = question;
				text.text = question;
				text.readOnly = true;
				text.size = "120";
				div.appendChild(text);


				div.appendChild(lineBreak);
				var lineBreak = document.createElement("br");
				div.appendChild(lineBreak);

				var numOfResponses = prompt("How many responses do you have?");
				

				for(var x = 0; x < numOfResponses; x++){
					var y = x
					y++;
					var response = prompt("Response # " + y + ":");
					//Send to the DB
					var radio = document.createElement("input");
					radio.type = "radio";
					radio.value = response;
					radio.text = response;
					radio.name = "question " + questionNum + "response";
					radio.id = "question " + questionNum + "response";
					div.appendChild(radio); 

					var label = document.createElement("Label");
					label.setAttribute("for", "question " + questionNum + "response");
					label.innerHTML = response;
					div.appendChild(label);

					/*var editBtn = document.createElement("input");
					editBtn.type = "button";
					editBtn.value = "Edit";
					editBtn.onclick = function editResponse(response){
						response = prompt("What do you want the response to say");
						label = response;
						return response;
					}

					div.appendChild(editBtn);*/

					var lineBreak = document.createElement("br");
					div.appendChild(lineBreak);
					var lineBreak = document.createElement("br");
					div.appendChild(lineBreak);

				}
				document.getElementById('content').appendChild(div);
			}

		</script>
	</head>

	<body onload = "addQuestion()">
		<div id = "wrapper">
			<h1>GSU Survey</h1>
			<div id="nav">
			<ul>
			</ul>
			</div>
			<div id ="content">
				<span id = "buttons">
					<input type = "button" value = "Create New Question" onclick="addQuestion()">
					<input type = "button" value = "FinishSurvey">
				</span>
				<br><br> 
			</div>
		</div>
	</body> 
</html>

<?php

                    if(isset($_POST['FinishSurvey'])) {
                        for($i = 0; $i <= $count; $i++){ // change to < and remove count++ from the end of all for loops
                            $update_id = $_POST[(string)$i];

                            //get the question id
                            //$question_id = substr($update_id, 0, strrchr($update_id, ".")-1);

                            $question_id = substr($update_id, 0, strpos($update_id, '.'));

                            // get the value of the answer
                            //$value = 2;//substr($update_id, strrchr($update_id, "."));
                            $value = substr($update_id, strpos($update_id, '.')+1);

                            $form = 1; // change to be dynamic later

                            
                            // get the form
                            
                            $insert_stmt = $mysqli->prepare("INSERT INTO answer_tbl (answer_question, answer_value, answer_form) VALUES (?, ?, ?)");
                            $insert_stmt->bind_param('ssi', $question_id, $value, $form);

                            // Execute the prepared query.
                            $insert_stmt->execute();
 

                        }
                        //echo '<script type="text/javascript"> window.location = "pulldb.php";</script>';
                        echo $question_id;
                    }
                    
                    ?>
